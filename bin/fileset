#!/usr/local/bin/python3
from sys import argv
import re
files = []
act = '+'
def Usage():
    tip = '''
    Usage:
        fileset file + file
        fileset file - file
        fileset file -+ file
    '''
    quit('Usage: fileset file + file');

field = 0;
argv.pop(0);
while len(argv):
    arg = argv.pop(0);
    if arg in ['-', '+', '-+']:
        act = arg;
    elif arg == '-f':
        arg = argv.pop(0)
        field = int(arg)
    elif re.match(r'^[\w\.\/]+$', arg):
        files.append(arg)
    else:
        Usage()

if (len(files)<2):
    Usage()

lines = {};
out = {}
for line in open(files[0]):
    line = line.strip()
    lines[line] =line

if act == '+':
    out = lines;
    for line in open(files[1]):
        line = line.strip()
        out[line] = line;
elif act == '-':
    out = lines;
    for line in [ line.strip() for line in open(files[1])]:
        if line in lines:
            out.pop(line)
elif act == '-+':
    out = {}
    for line in [ line.strip() for line in open(files[1])]:
        key = line.split(',')[field-1]  if field else line;
        if key in lines:
            out[key] = line

for k,v in out.items():
    print(v)
